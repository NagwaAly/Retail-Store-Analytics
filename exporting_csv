import pyodbc
import csv

conn = pyodbc.connect(
    'DRIVER={ODBC Driver 17 for SQL Server};'
    'SERVER=DESKTOP-M70NM43\\MSSQLSERVER01;' 
    'DATABASE=RetailStoreDB;'
    'Trusted_Connection=yes;'
)
cursor = conn.cursor()

def xport_csv(table_name, filename):
    cursor.execute(f"SELECT * FROM {table_name}")
    rows = cursor.fetchall()
    columns = [column[0] for column in cursor.description]

    with open(filename, "w", newline="", encoding="utf-8") as file:
        writer = csv.writer(file)
        writer.writerow(columns) 
        writer.writerows(rows)     

xport_csv("dimdate", "Dim_Date.csv")
xport_csv("dimcustomers", "Dim_Customers.csv")
xport_csv("dimproducts", "Dim_Products.csv")
xport_csv("dimorders", "Dim_Orders.csv")
xport_csv("dimpayments", "Dim_Payments.csv")
xport_csv("dimreturns", "Dim_Returns.csv")
xport_csv("dimdiscounts", "Dim_Discounts.csv")
xport_csv("factsales", "Fact_Sales.csv")

cursor.close()
conn.close()

print("files exported successfully")
